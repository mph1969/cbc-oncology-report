<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CBC Oncology Report â€” Michael Patrick Hanson</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Noto+Sans+SC:wght@300;400;500;700&display=swap');

  :root {
    --bg: #0f1623;
    --panel: #161f30;
    --border: #1e2d45;
    --accent: #3b8aff;
    --accent-glow: rgba(59,138,255,0.12);
    --low: #ff6b6b;
    --high: #ffaa00;
    --normal: #34d399;
    --text: #e2eaf5;
    --muted: #7a90a8;
    --grid: #1a2640;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    padding: 16px;
  }

  body.lang-zh { font-family: 'Noto Sans SC', 'DM Mono', monospace; }

  /* â”€â”€ LANG SWITCH â”€â”€ */
  .lang-bar {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 10px;
    gap: 4px;
  }
  .lang-btn {
    background: var(--panel);
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 5px 14px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    font-family: inherit;
    transition: all 0.2s;
  }
  .lang-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }

  /* â”€â”€ HEADER â”€â”€ */
  .header {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 12px;
  }
  .header-label {
    font-size: 11px;
    color: var(--accent);
    letter-spacing: 2px;
    font-weight: 600;
    margin-bottom: 4px;
    text-transform: uppercase;
  }
  .header-name {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
  }
  .header-sub {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
  }
  .header-right { text-align: right; }
  .header-right div { font-size: 12px; color: var(--text); }
  .header-right .label { font-size: 11px; color: var(--muted); margin-bottom: 2px; }
  .header-right .highlight { color: var(--accent); font-weight: 600; }

  /* â”€â”€ TABS â”€â”€ */
  .tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 12px;
    flex-wrap: wrap;
  }
  .tab-btn {
    padding: 7px 16px;
    border-radius: 6px;
    border: 1px solid var(--border);
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    background: var(--panel);
    color: var(--muted);
    transition: all 0.2s;
  }
  .tab-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: #fff;
  }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* â”€â”€ PANELS â”€â”€ */
  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 12px;
  }
  .card-title {
    font-size: 11px;
    font-weight: 700;
    color: var(--muted);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  /* â”€â”€ CYCLE TIMELINE â”€â”€ */
  .timeline {
    display: flex;
    align-items: center;
    gap: 0;
    overflow-x: auto;
    padding-bottom: 8px;
  }
  .timeline-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    flex: 1;
    min-width: 90px;
  }
  .timeline-dot {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 700;
    border: 2px solid;
  }
  .timeline-label { font-size: 10px; font-weight: 600; white-space: nowrap; }
  .timeline-date { font-size: 10px; color: var(--muted); }
  .timeline-line { flex: 1; height: 1px; background: var(--border); margin: 0 2px; margin-bottom: 20px; }
  .timeline-note {
    margin-top: 10px;
    padding: 8px 12px;
    background: var(--accent-glow);
    border-radius: 6px;
    font-size: 11px;
    color: var(--accent);
    line-height: 1.6;
  }

  /* â”€â”€ ALERT CARDS â”€â”€ */
  .alert-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    margin-bottom: 6px;
    border-radius: 6px;
    border: 1px solid;
    flex-wrap: wrap;
    gap: 6px;
  }
  .alert-name { font-size: 13px; font-weight: 600; }
  .alert-ref { font-size: 11px; color: var(--muted); margin-top: 2px; }
  .alert-value { font-size: 15px; font-weight: 700; }
  .alert-badge {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1px;
    padding: 2px 7px;
    border-radius: 4px;
    border: 1px solid;
  }

  /* â”€â”€ KEY METRICS GRID â”€â”€ */
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 10px;
  }
  .metric-card {
    background: var(--bg);
    border-radius: 8px;
    padding: 12px;
    border: 1px solid;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .metric-label { font-size: 10px; color: var(--muted); font-weight: 600; }
  .metric-value { font-size: 22px; font-weight: 700; line-height: 1; }
  .metric-unit { font-size: 10px; color: var(--muted); }
  .metric-ref { font-size: 9px; color: var(--muted); }

  /* â”€â”€ GAUGE â”€â”€ */
  .gauge-track {
    position: relative;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin: 4px 0 2px;
  }
  .gauge-normal-zone {
    position: absolute;
    left: 10%; right: 10%;
    top: 0; bottom: 0;
    border-radius: 2px;
  }
  .gauge-dot {
    position: absolute;
    top: -4px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    transform: translateX(-50%);
    box-shadow: 0 0 6px;
  }
  .gauge-labels {
    display: flex;
    justify-content: space-between;
  }
  .gauge-labels span { font-size: 9px; color: var(--muted); }

  /* â”€â”€ CLINICAL NOTES â”€â”€ */
  .clinical-note {
    padding: 10px 14px;
    margin-bottom: 8px;
    border-radius: 0 6px 6px 0;
    border-left: 3px solid;
    font-size: 12px;
    line-height: 1.7;
  }
  .clinical-note strong { display: block; margin-bottom: 4px; font-size: 13px; }

  /* â”€â”€ CHARTS â”€â”€ */
  .chart-note {
    font-size: 11px;
    color: var(--muted);
    padding: 6px 12px;
    background: var(--panel);
    border-radius: 6px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
  }
  .chart-card { margin-bottom: 12px; }
  .chart-card canvas { max-height: 200px; }

  /* â”€â”€ FULL CBC TABLE â”€â”€ */
  .cbc-group-title {
    font-size: 11px;
    color: var(--accent);
    font-weight: 700;
    letter-spacing: 0.5px;
    margin: 14px 0 8px;
  }
  .cbc-row {
    display: grid;
    grid-template-columns: 1fr 90px 50px 130px;
    align-items: center;
    gap: 8px;
    padding: 6px 0;
    border-bottom: 1px solid var(--border);
    font-size: 12px;
  }
  .cbc-row-name { color: var(--muted); }
  .cbc-row-val { text-align: right; font-weight: 500; }
  .cbc-row-badge { text-align: center; }
  .cbc-row-gauge {}

  /* â”€â”€ PRINT â”€â”€ */
  @media print {
    body { background: #fff; color: #000; padding: 8px; }
    .lang-bar, .tabs { display: none; }
    .tab-panel { display: block !important; }
    .card { break-inside: avoid; border: 1px solid #ccc; background: #f9f9f9; }
    .header { background: #f0f4ff; }
    :root { --text: #111; --muted: #555; --panel: #f5f8ff; --bg: #fff; --border: #dde; }
  }

  @media (max-width: 480px) {
    .header { flex-direction: column; }
    .header-right { text-align: left; }
    .cbc-row { grid-template-columns: 1fr 70px 40px 100px; font-size: 11px; }
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TRANSLATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
const T = {
  en: {
    pageTitle: "CBC Oncology Tracking Report",
    reportLabel: "ONCOLOGY Â· CBC TRACKING",
    patientName: "Michael Patrick Hanson",
    reportSubtitle: "CapeOX Chemotherapy Â· Weekly Monitoring Report",
    oncologists: "Oncologists",
    drLiu: "Dr. Liu Â· Hong Kong",
    drWen: "Dr. Wen Â· Guangzhou",
    latestDraw: "Latest draw",
    draws: "draws recorded",
    tabSummary: "Summary",
    tabCharts: "Trend Charts",
    tabFull: "Full CBC",
    timelineTitle: "CapeOX Treatment Timeline",
    cycleLabel: ["Cycle 1", "Cycle 2", "Cycle 3 (Next)"],
    cycleDates: ["Jan 19, 2026", "Feb 11, 2026", "Mar 4, 2026"],
    timelineNote: "ğŸ“… Feb 24 draw = <strong>Cycle 2, Day 14</strong> Â· Typical nadir: Days 10â€“14 post-infusion Â· Next infusion: <strong>March 4</strong> Â· Current draw count: 4 draws spanning both cycles",
    flagsTitle: "âš  Flags & Alerts â€” Latest Draw (Feb 24)",
    allNormal: "All values within reference range âœ“",
    keyMetricsTitle: "Key Oncology Markers â€” Latest Draw",
    clinicalTitle: "Clinical Interpretation & Trends",
    chartNote: "ğŸ“Š 4 draws: Jan 26 (C1D7) â†’ Feb 2 (C1D14) â†’ Feb 18 (C2D7) â†’ Feb 24 (C2D14). Dashed lines = reference range boundaries.",
    fullCBCTitle: "Complete Blood Count â€” All Values",
    refRange: "ref",
    statusLow: "â–¼ LOW",
    statusHigh: "â–² HIGH",
    statusNormal: "âœ“",
    disclaimer: "This report is for clinical reference only. Always consult your oncologist for treatment decisions.",
    groups: [
      "ğŸ”´ Priority: Infection / Immune Risk",
      "ğŸ©¸ Red Cell / Anemia Markers",
      "ğŸŸ¡ Platelet / Bleeding Risk",
      "Other WBC Differentials"
    ],
    clinicalNotes: [
      {
        color: "low",
        title: "âš  KEY FINDING â€” ANC Cliff Between Cycles",
        body: "C1D7: <strong>2.84</strong> âœ“ â†’ C1D14: <strong>2.85</strong> âœ“ â†’ C2D7: <strong>1.66</strong> â†“ â†’ C2D14: <strong>1.71</strong> â†“<br>Cycle 1 ANC was stable and fully normal (Days 7 & 14 both ~2.85). Cycle 2 opened at 1.66 â€” already below threshold by Day 7 â€” with almost no recovery by Day 14. This is a sharp step-change drop suggesting cumulative oxaliplatin myelosuppression is intensifying. <strong>Pre-Cycle 3 ANC check strongly recommended before March 4 infusion.</strong>"
      },
      {
        color: "high",
        title: "Mono% Pattern â€” Worsening Cycle-to-Cycle",
        body: "C1D7: <strong>6.1%</strong> (normal) â†’ C1D14: <strong>8.6%</strong> (â†‘) â†’ C2D7: <strong>11.4%</strong> (â†‘â†‘) â†’ C2D14: <strong>10.3%</strong> (â†‘, slight improvement).<br>Mono% was normal in early Cycle 1 but consistently above range since C1D14. Absolute Mono# remains in range throughout. Pattern may reflect treatment-associated immune modulation or persistent low-grade inflammation."
      },
      {
        color: "normal",
        title: "HGB & WBC â€” Gradual Mild Decline, Currently Stable",
        body: "HGB: 153 â†’ 152 â†’ 150 â†’ 147 g/L â€” slow progressive decline, still comfortably within range (130â€“175). WBC: 4.72 â†’ 5.15 â†’ 4.16 â†’ 4.21 â€” slight dip in Cycle 2. PLT: elevated in C1 (350â€“353), normalised in C2 (247â€“258). Trajectory bears watching over subsequent cycles."
      },
      {
        color: "accent",
        title: "PDW 22.9 & PCT 0.337 â€” Elevated C1D7 Only",
        body: "Both platelet distribution markers were elevated on Jan 26 (C1D7) and normalised in all subsequent draws. Likely transient, near treatment initiation. No ongoing concern based on current data."
      }
    ],
    chartTitles: ["WBC & ANC (Neutrophils)", "Platelets (PLT)", "Hemoglobin (HGB)", "Lymphocytes % & Monocytes %", "Red Cell Volume (MCV)"],
    chartLabels: {
      WBC: "WBC", Neut_abs: "ANC (Neut#)", PLT: "PLT", HGB: "HGB",
      Lymph_pct: "Lymph%", Mono_pct: "Mono%", MCV: "MCV"
    }
  },
  zh: {
    pageTitle: "è¡€å¸¸è§„è‚¿ç˜¤ç›‘æµ‹æŠ¥å‘Š",
    reportLabel: "è‚¿ç˜¤ç§‘ Â· è¡€å¸¸è§„è¿½è¸ª",
    patientName: "Michael Patrick Hansonï¼ˆéŸ©è¿ˆå…‹ï¼‰",
    reportSubtitle: "å¡åŸ¹ä»–æ»¨+å¥¥æ²™åˆ©é“‚ï¼ˆCapeOXï¼‰åŒ–ç–— Â· æ¯å‘¨ç›‘æµ‹æŠ¥å‘Š",
    oncologists: "ä¸»æ²»åŒ»ç”Ÿ",
    drLiu: "å»–åŒ»ç”Ÿ Â· é¦™æ¸¯",
    drWen: "æ–‡åŒ»ç”Ÿ Â· å¹¿å·",
    latestDraw: "æœ€è¿‘æŠ½è¡€æ—¥æœŸ",
    draws: "ä»½è®°å½•",
    tabSummary: "æ‘˜è¦",
    tabCharts: "è¶‹åŠ¿å›¾è¡¨",
    tabFull: "å®Œæ•´è¡€å¸¸è§„",
    timelineTitle: "CapeOX æ²»ç–—æ—¶é—´çº¿",
    cycleLabel: ["ç¬¬1å‘¨æœŸ", "ç¬¬2å‘¨æœŸ", "ç¬¬3å‘¨æœŸï¼ˆå¾…å®šï¼‰"],
    cycleDates: ["2026å¹´1æœˆ19æ—¥", "2026å¹´2æœˆ11æ—¥", "2026å¹´3æœˆ4æ—¥"],
    timelineNote: "ğŸ“… 2æœˆ24æ—¥æŠ½è¡€ = <strong>ç¬¬2å‘¨æœŸç¬¬14å¤©</strong> Â· å…¸å‹è¡€ç»†èƒæœ€ä½ç‚¹ï¼šè¾“æ¶²åç¬¬10â€“14å¤© Â· ä¸‹æ¬¡è¾“æ¶²ï¼š<strong>3æœˆ4æ—¥</strong> Â· å½“å‰å…±è®°å½•4ä»½è¡€å¸¸è§„ï¼Œè¦†ç›–ä¸¤ä¸ªå®Œæ•´å‘¨æœŸ",
    flagsTitle: "âš  å¼‚å¸¸é¡¹ç›®æç¤º â€” æœ€è¿‘ä¸€æ¬¡æŠ½è¡€ï¼ˆ2æœˆ24æ—¥ï¼‰",
    allNormal: "æ‰€æœ‰æŒ‡æ ‡å‡åœ¨å‚è€ƒèŒƒå›´å†… âœ“",
    keyMetricsTitle: "å…³é”®è‚¿ç˜¤ç§‘æŒ‡æ ‡ â€” æœ€è¿‘ä¸€æ¬¡æŠ½è¡€",
    clinicalTitle: "ä¸´åºŠè§£è¯»ä¸è¶‹åŠ¿åˆ†æ",
    chartNote: "ğŸ“Š å…±4æ¬¡æŠ½è¡€ï¼š1æœˆ26æ—¥ï¼ˆC1D7ï¼‰â†’ 2æœˆ2æ—¥ï¼ˆC1D14ï¼‰â†’ 2æœˆ18æ—¥ï¼ˆC2D7ï¼‰â†’ 2æœˆ24æ—¥ï¼ˆC2D14ï¼‰ã€‚è™šçº¿ä¸ºå‚è€ƒèŒƒå›´ä¸Šä¸‹é™ã€‚",
    fullCBCTitle: "å®Œæ•´è¡€å¸¸è§„æ•°å€¼ â€” æ‰€æœ‰æŒ‡æ ‡",
    refRange: "å‚è€ƒèŒƒå›´",
    statusLow: "â–¼ åä½",
    statusHigh: "â–² åé«˜",
    statusNormal: "âœ“",
    disclaimer: "æœ¬æŠ¥å‘Šä»…ä¾›ä¸´åºŠå‚è€ƒï¼Œæ‰€æœ‰æ²»ç–—å†³ç­–è¯·å’¨è¯¢ä¸»æ²»åŒ»ç”Ÿã€‚",
    groups: [
      "ğŸ”´ é‡ç‚¹å…³æ³¨ï¼šæ„ŸæŸ“é£é™© / å…ç–«åŠŸèƒ½",
      "ğŸ©¸ çº¢ç»†èƒ / è´«è¡€ç›¸å…³æŒ‡æ ‡",
      "ğŸŸ¡ è¡€å°æ¿ / å‡ºè¡€é£é™©",
      "å…¶ä»–ç™½ç»†èƒåˆ†ç±»"
    ],
    clinicalNotes: [
      {
        color: "low",
        title: "âš  å…³é”®å‘ç° â€” ä¸¤ä¸ªå‘¨æœŸä¹‹é—´ä¸­æ€§ç²’ç»†èƒéª¤é™",
        body: "C1D7ï¼š<strong>2.84</strong> âœ“ â†’ C1D14ï¼š<strong>2.85</strong> âœ“ â†’ C2D7ï¼š<strong>1.66</strong> â†“ â†’ C2D14ï¼š<strong>1.71</strong> â†“<br>ç¬¬1å‘¨æœŸä¸­æ€§ç²’ç»†èƒç»å¯¹å€¼ï¼ˆANCï¼‰åœ¨ç¬¬7å¤©å’Œç¬¬14å¤©å‡ä¿æŒæ­£å¸¸ï¼ˆçº¦2.85ï¼‰ã€‚ç¬¬2å‘¨æœŸç¬¬7å¤©å³å·²ä½äºå‚è€ƒä¸‹é™ï¼ˆ1.66ï¼‰ï¼Œè‡³ç¬¬14å¤©å‡ ä¹æ— æ¢å¤ï¼ˆ1.71ï¼‰ã€‚æ­¤ä¸ºå…¸å‹çš„å¥¥æ²™åˆ©é“‚ç´¯ç§¯æ€§éª¨é«“æŠ‘åˆ¶åŠ é‡è¡¨ç°ï¼Œè€Œéç¼“æ…¢ä¸‹é™è¶‹åŠ¿ã€‚<strong>å¼ºçƒˆå»ºè®®åœ¨3æœˆ4æ—¥ç¬¬3å‘¨æœŸè¾“æ¶²å‰è¿›è¡ŒANCå¤æŸ¥ï¼Œç¡®è®¤æ˜¯å¦è¾¾åˆ°è¾“æ¶²æ ‡å‡†ã€‚</strong>"
      },
      {
        color: "high",
        title: "å•æ ¸ç»†èƒç™¾åˆ†æ¯” â€” é€å‘¨æœŸå‡é«˜è¶‹åŠ¿",
        body: "C1D7ï¼š<strong>6.1%</strong>ï¼ˆæ­£å¸¸ï¼‰â†’ C1D14ï¼š<strong>8.6%</strong>ï¼ˆâ†‘ï¼‰â†’ C2D7ï¼š<strong>11.4%</strong>ï¼ˆâ†‘â†‘ï¼‰â†’ C2D14ï¼š<strong>10.3%</strong>ï¼ˆâ†‘ï¼Œç•¥æœ‰æ”¹å–„ï¼‰ã€‚<br>å•æ ¸ç»†èƒç™¾åˆ†æ¯”åœ¨ç¬¬1å‘¨æœŸåˆæœŸæ­£å¸¸ï¼Œè‡ªC1D14èµ·æŒç»­è¶…å‡ºå‚è€ƒä¸Šé™ï¼ˆ3.0â€“8.0%ï¼‰ã€‚å•æ ¸ç»†èƒç»å¯¹å€¼ï¼ˆMono#ï¼‰å§‹ç»ˆåœ¨æ­£å¸¸èŒƒå›´å†…ã€‚æ­¤æ¨¡å¼å¯èƒ½ä¸åŒ–ç–—ç›¸å…³çš„å…ç–«è°ƒèŠ‚æˆ–æŒç»­è½»åº¦ç‚ç—‡ååº”æœ‰å…³ï¼Œå»ºè®®æŒç»­ç›‘æµ‹ã€‚"
      },
      {
        color: "normal",
        title: "è¡€çº¢è›‹ç™½ï¼ˆHGBï¼‰ä¸ç™½ç»†èƒæ€»æ•°ï¼ˆWBCï¼‰â€” ç¼“æ…¢ä¸‹é™ï¼Œç›®å‰ä»åœ¨æ­£å¸¸èŒƒå›´",
        body: "HGBï¼š153 â†’ 152 â†’ 150 â†’ 147 g/L â€” ç¼“æ…¢ä¸‹é™ï¼Œä»åœ¨æ­£å¸¸èŒƒå›´å†…ï¼ˆ130â€“175 g/Lï¼‰ã€‚WBCï¼š4.72 â†’ 5.15 â†’ 4.16 â†’ 4.21 â€” ç¬¬2å‘¨æœŸç•¥ä½ã€‚è¡€å°æ¿ï¼ˆPLTï¼‰ï¼šç¬¬1å‘¨æœŸåé«˜ï¼ˆ350â€“353ï¼‰ï¼Œç¬¬2å‘¨æœŸæ¢å¤æ­£å¸¸ï¼ˆ247â€“258ï¼‰ã€‚éšåå‘¨æœŸéœ€ç»§ç»­è§‚å¯Ÿè¶‹åŠ¿ã€‚"
      },
      {
        color: "accent",
        title: "PDW 22.9 & PCT 0.337 â€” ä»…è§äºC1D7ï¼Œåç»­æ­£å¸¸",
        body: "è¡€å°æ¿åˆ†å¸ƒå®½åº¦ï¼ˆPDWï¼‰å’Œè¡€å°æ¿æ¯”å®¹ï¼ˆPCTï¼‰åœ¨1æœˆ26æ—¥ï¼ˆC1D7ï¼‰åé«˜ï¼Œåç»­ä¸‰æ¬¡æŠ½è¡€å‡å·²æ­£å¸¸ã€‚å¯èƒ½ä¸ºæ²»ç–—åˆå§‹é˜¶æ®µçš„ä¸€è¿‡æ€§å˜åŒ–ï¼Œæ ¹æ®ç°æœ‰æ•°æ®æ— éœ€ç‰¹åˆ«å…³æ³¨ã€‚"
      }
    ],
    chartTitles: ["ç™½ç»†èƒæ€»æ•° & ä¸­æ€§ç²’ç»†èƒç»å¯¹å€¼ï¼ˆANCï¼‰", "è¡€å°æ¿ï¼ˆPLTï¼‰", "è¡€çº¢è›‹ç™½ï¼ˆHGBï¼‰", "æ·‹å·´ç»†èƒ% & å•æ ¸ç»†èƒ%", "å¹³å‡çº¢ç»†èƒä½“ç§¯ï¼ˆMCVï¼‰"],
    chartLabels: {
      WBC: "ç™½ç»†èƒ", Neut_abs: "ANCï¼ˆä¸­æ€§ç²’ç»†èƒï¼‰", PLT: "è¡€å°æ¿", HGB: "è¡€çº¢è›‹ç™½",
      Lymph_pct: "æ·‹å·´ç»†èƒ%", Mono_pct: "å•æ ¸ç»†èƒ%", MCV: "MCV"
    }
  }
};

// â”€â”€â”€ REFERENCE RANGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const REFS = {
  WBC:       { lo:3.5,   hi:9.5,   unit:"10â¹/L",  en:"WBC (White Blood Cells)",          zh:"ç™½ç»†èƒæ€»æ•°ï¼ˆWBCï¼‰" },
  Neut_abs:  { lo:1.8,   hi:6.3,   unit:"10â¹/L",  en:"ANC (Absolute Neutrophils)",       zh:"ä¸­æ€§ç²’ç»†èƒç»å¯¹å€¼ï¼ˆANCï¼‰" },
  Neut_pct:  { lo:40,    hi:75,    unit:"%",       en:"Neutrophils %",                    zh:"ä¸­æ€§ç²’ç»†èƒç™¾åˆ†æ¯”" },
  PLT:       { lo:125,   hi:350,   unit:"10â¹/L",  en:"Platelets",                        zh:"è¡€å°æ¿è®¡æ•°ï¼ˆPLTï¼‰" },
  HGB:       { lo:130,   hi:175,   unit:"g/L",    en:"Hemoglobin",                       zh:"è¡€çº¢è›‹ç™½ï¼ˆHGBï¼‰" },
  RBC:       { lo:4.3,   hi:5.8,   unit:"10Â¹Â²/L", en:"Red Blood Cells",                  zh:"çº¢ç»†èƒæ€»æ•°ï¼ˆRBCï¼‰" },
  Lymph_abs: { lo:1.1,   hi:3.2,   unit:"10â¹/L",  en:"Lymphocytes (Abs)",                zh:"æ·‹å·´ç»†èƒç»å¯¹å€¼" },
  Lymph_pct: { lo:20,    hi:50,    unit:"%",       en:"Lymphocytes %",                    zh:"æ·‹å·´ç»†èƒç™¾åˆ†æ¯”" },
  Mono_abs:  { lo:0.1,   hi:0.6,   unit:"10â¹/L",  en:"Monocytes (Abs)",                  zh:"å•æ ¸ç»†èƒç»å¯¹å€¼" },
  Mono_pct:  { lo:3.0,   hi:8.0,   unit:"%",       en:"Monocytes %",                      zh:"å•æ ¸ç»†èƒç™¾åˆ†æ¯”" },
  Hct:       { lo:40,    hi:50,    unit:"%",       en:"Hematocrit",                       zh:"çº¢ç»†èƒæ¯”å®¹ï¼ˆHctï¼‰" },
  MCV:       { lo:82,    hi:100,   unit:"fL",      en:"MCV (Mean Cell Volume)",           zh:"å¹³å‡çº¢ç»†èƒä½“ç§¯ï¼ˆMCVï¼‰" },
  MCH:       { lo:27,    hi:34,    unit:"pg",      en:"MCH",                              zh:"å¹³å‡çº¢ç»†èƒè¡€çº¢è›‹ç™½é‡ï¼ˆMCHï¼‰" },
  MCHC:      { lo:320,   hi:360,   unit:"g/L",    en:"MCHC",                             zh:"å¹³å‡çº¢ç»†èƒè¡€çº¢è›‹ç™½æµ“åº¦ï¼ˆMCHCï¼‰" },
  RDW_CV:    { lo:11.5,  hi:14.5,  unit:"%",       en:"RDW-CV",                           zh:"çº¢ç»†èƒåˆ†å¸ƒå®½åº¦CV" },
  RDW_SD:    { lo:37,    hi:54,    unit:"fL",      en:"RDW-SD",                           zh:"çº¢ç»†èƒåˆ†å¸ƒå®½åº¦SD" },
  MPV:       { lo:9.4,   hi:12.5,  unit:"fL",      en:"MPV (Mean Platelet Volume)",       zh:"å¹³å‡è¡€å°æ¿å®¹ç§¯ï¼ˆMPVï¼‰" },
  PDW:       { lo:15.5,  hi:18.1,  unit:"fL",      en:"PDW (Platelet Dist. Width)",       zh:"è¡€å°æ¿åˆ†å¸ƒå®½åº¦ï¼ˆPDWï¼‰" },
  PCT:       { lo:0.108, hi:0.272, unit:"%",       en:"PCT (Plateletcrit)",               zh:"è¡€å°æ¿æ¯”å®¹ï¼ˆPCTï¼‰" },
  P_LCR:     { lo:13.0,  hi:43.0,  unit:"%",       en:"P-LCR (Large Platelet Ratio)",     zh:"å¤§è¡€å°æ¿æ¯”ä¾‹ï¼ˆP-LCRï¼‰" },
  Eos_pct:   { lo:0.5,   hi:5.0,   unit:"%",       en:"Eosinophils %",                    zh:"å—œé…¸æ€§ç²’ç»†èƒç™¾åˆ†æ¯”" },
  Eos_abs:   { lo:0.02,  hi:0.52,  unit:"10â¹/L",  en:"Eosinophils (Abs)",                zh:"å—œé…¸æ€§ç²’ç»†èƒç»å¯¹å€¼" },
  Baso_pct:  { lo:0,     hi:2.5,   unit:"%",       en:"Basophils %",                      zh:"å—œç¢±æ€§ç²’ç»†èƒç™¾åˆ†æ¯”" },
  Baso_abs:  { lo:0,     hi:0.06,  unit:"10â¹/L",  en:"Basophils (Abs)",                  zh:"å—œç¢±æ€§ç²’ç»†èƒç»å¯¹å€¼" },
};

// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DATA = [
  { date:"Jan 26\nC1D7",  fullDate:"Jan 26, 2026", cycleZH:"ç¬¬1å‘¨æœŸç¬¬7å¤©",
    WBC:4.72,  Neut_abs:2.84, Neut_pct:60.1, PLT:350,  HGB:153, RBC:4.91,
    Lymph_abs:1.48, Lymph_pct:31.2, Mono_abs:0.30, Mono_pct:6.1,
    Hct:46.7, MCV:95.1, MCH:31.2, MCHC:328, RDW_CV:12.7, RDW_SD:44.1,
    MPV:9.6, PDW:22.9, PCT:0.337, P_LCR:16.0, Eos_pct:2.2, Eos_abs:0.10, Baso_pct:0.1, Baso_abs:0.00 },
  { date:"Feb 2\nC1D14", fullDate:"Feb 2, 2026", cycleZH:"ç¬¬1å‘¨æœŸç¬¬14å¤©",
    WBC:5.15,  Neut_abs:2.85, Neut_pct:55.3, PLT:353,  HGB:152, RBC:4.90,
    Lymph_abs:1.72, Lymph_pct:33.4, Mono_abs:0.41, Mono_pct:8.6,
    Hct:48.0, MCV:98.0, MCH:30.9, MCHC:317, RDW_CV:13.1, RDW_SD:46.1,
    MPV:8.9, PDW:16.2, PCT:0.316, P_LCR:18.8, Eos_pct:2.6, Eos_abs:0.13, Baso_pct:0.1, Baso_abs:0.01 },
  { date:"Feb 18\nC2D7",  fullDate:"Feb 18, 2026", cycleZH:"ç¬¬2å‘¨æœŸç¬¬7å¤©",
    WBC:4.16,  Neut_abs:1.66, Neut_pct:39.9, PLT:247,  HGB:150, RBC:4.72,
    Lymph_abs:1.93, Lymph_pct:46.4, Mono_abs:0.47, Mono_pct:11.4,
    Hct:46.0, MCV:97.4, MCH:31.8, MCHC:326, RDW_CV:14.1, RDW_SD:49.2,
    MPV:9.5, PDW:16.4, PCT:0.235, P_LCR:22.6, Eos_pct:2.3, Eos_abs:0.10, Baso_pct:0.0, Baso_abs:0.00 },
  { date:"Feb 24\nC2D14", fullDate:"Feb 24, 2026", cycleZH:"ç¬¬2å‘¨æœŸç¬¬14å¤©",
    WBC:4.21,  Neut_abs:1.71, Neut_pct:40.6, PLT:258,  HGB:147, RBC:4.60,
    Lymph_abs:2.00, Lymph_pct:47.4, Mono_abs:0.43, Mono_pct:10.3,
    Hct:45.1, MCV:98.1, MCH:31.9, MCHC:326, RDW_CV:14.5, RDW_SD:51.1,
    MPV:9.3, PDW:16.5, PCT:0.239, P_LCR:21.9, Eos_pct:1.7, Eos_abs:0.07, Baso_pct:0.0, Baso_abs:0.00 },
];

const LATEST = DATA[DATA.length - 1];
const CHART_LABELS = DATA.map(d => d.date.replace('\n',' '));

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getStatus(key, val) {
  const r = REFS[key];
  if (!r || val === null || val === undefined) return "normal";
  if (val < r.lo) return "low";
  if (val > r.hi) return "high";
  return "normal";
}
function pctPos(key, val) {
  const r = REFS[key];
  const range = r.hi - r.lo;
  const p = ((val - r.lo) / range) * 100;
  return Math.max(0, Math.min(100, 10 + p * 0.8));
}
const COLORS = { low:"#ff6b6b", high:"#ffaa00", normal:"#34d399", accent:"#3b8aff" };

let currentLang = "en";
let charts = {};
let selectedDrawIndex = DATA.length - 1; // default to latest
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HTML STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<div class="lang-bar">
  <button class="lang-btn active" onclick="setLang('en')" id="btn-en">EN</button>
  <button class="lang-btn" onclick="setLang('zh')" id="btn-zh">ä¸­æ–‡</button>
</div>

<!-- HEADER -->
<div class="header">
  <div>
    <div class="header-label" id="h-label"></div>
    <div class="header-name" id="h-name"></div>
    <div class="header-sub" id="h-sub"></div>
  </div>
  <div class="header-right">
    <div class="label" id="h-onc-label"></div>
    <div id="h-dr1"></div>
    <div id="h-dr2"></div>
    <div style="margin-top:6px">
      <span class="label" id="h-draw-label"></span>
      <span class="highlight"> Feb 24, 2026</span>
      &nbsp;Â·&nbsp;
      <span id="h-draw-count" style="color:var(--muted);font-size:11px"></span>
    </div>
  </div>
</div>

<!-- TABS -->
<div class="tabs">
  <button class="tab-btn active" onclick="showTab('summary')" id="tab-summary"></button>
  <button class="tab-btn" onclick="showTab('charts')" id="tab-charts"></button>
  <button class="tab-btn" onclick="showTab('full')" id="tab-full"></button>
</div>

<!-- â”€â”€ TAB: SUMMARY â”€â”€ -->
<div class="tab-panel active" id="panel-summary">

  <!-- Cycle Timeline -->
  <div class="card">
    <div class="card-title" id="s-timeline-title"></div>
    <div class="timeline" id="s-timeline"></div>
    <div class="timeline-note" id="s-timeline-note"></div>
  </div>

  <!-- Alerts -->
  <div class="card">
    <div class="card-title" id="s-flags-title"></div>
    <div id="s-alerts"></div>
  </div>

  <!-- Key Metrics -->
  <div class="card">
    <div class="card-title" id="s-metrics-title"></div>
    <div class="metrics-grid" id="s-metrics"></div>
  </div>

  <!-- Clinical Notes -->
  <div class="card">
    <div class="card-title" id="s-clinical-title"></div>
    <div id="s-clinical"></div>
  </div>

</div>

<!-- â”€â”€ TAB: CHARTS â”€â”€ -->
<div class="tab-panel" id="panel-charts">
  <div class="chart-note" id="c-note"></div>
  <div class="card chart-card"><div class="card-title" id="ct-0"></div><canvas id="chart-0"></canvas></div>
  <div class="card chart-card"><div class="card-title" id="ct-1"></div><canvas id="chart-1"></canvas></div>
  <div class="card chart-card"><div class="card-title" id="ct-2"></div><canvas id="chart-2"></canvas></div>
  <div class="card chart-card"><div class="card-title" id="ct-3"></div><canvas id="chart-3"></canvas></div>
  <div class="card chart-card"><div class="card-title" id="ct-4"></div><canvas id="chart-4"></canvas></div>
</div>

<!-- â”€â”€ TAB: FULL CBC â”€â”€ -->
<div class="tab-panel" id="panel-full">
  <div id="f-draw-selector" style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px"></div>
  <div class="card">
    <div class="card-title" id="f-title"></div>
    <div id="f-table"></div>
  </div>
</div>

<!-- FOOTER -->
<div style="text-align:center;padding:16px 0 8px;font-size:10px;color:var(--muted)" id="footer"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RENDER LOGIC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
function setLang(lang) {
  currentLang = lang;
  document.body.className = lang === 'zh' ? 'lang-zh' : '';
  document.getElementById('btn-en').className = 'lang-btn' + (lang==='en'?' active':'');
  document.getElementById('btn-zh').className = 'lang-btn' + (lang==='zh'?' active':'');
  renderAll();
}

function showTab(name) {
  ['summary','charts','full'].forEach(t => {
    document.getElementById('panel-'+t).className = 'tab-panel' + (t===name?' active':'');
    document.getElementById('tab-'+t).className = 'tab-btn' + (t===name?' active':'');
  });
  if (name === 'charts') renderCharts();
}

function renderAll() {
  const t = T[currentLang];
  document.title = t.pageTitle;

  // Header
  document.getElementById('h-label').textContent = t.reportLabel;
  document.getElementById('h-name').textContent = t.patientName;
  document.getElementById('h-sub').textContent = t.reportSubtitle;
  document.getElementById('h-onc-label').textContent = t.oncologists;
  document.getElementById('h-dr1').textContent = t.drLiu;
  document.getElementById('h-dr2').textContent = t.drWen;
  document.getElementById('h-draw-label').textContent = t.latestDraw + ':';
  document.getElementById('h-draw-count').textContent = '4 ' + t.draws;

  // Tabs
  document.getElementById('tab-summary').textContent = t.tabSummary;
  document.getElementById('tab-charts').textContent = t.tabCharts;
  document.getElementById('tab-full').textContent = t.tabFull;

  renderSummary();
  renderFull();
  renderCharts();
}

function renderSummary() {
  const t = T[currentLang];
  document.getElementById('s-timeline-title').textContent = t.timelineTitle;
  document.getElementById('s-flags-title').textContent = t.flagsTitle;
  document.getElementById('s-metrics-title').textContent = t.keyMetricsTitle;
  document.getElementById('s-clinical-title').textContent = t.clinicalTitle;

  // Timeline
  const tlColors = ['#3b8aff','#3b8aff','#ffaa00'];
  let tlHTML = '';
  t.cycleLabel.forEach((label, i) => {
    tlHTML += `
      <div class="timeline-item">
        <div class="timeline-dot" style="color:${tlColors[i]};border-color:${tlColors[i]};background:${tlColors[i]}22">
          ${i+1}
        </div>
        <div class="timeline-label" style="color:${tlColors[i]}">${label}</div>
        <div class="timeline-date">${t.cycleDates[i]}</div>
      </div>`;
    if (i < t.cycleLabel.length - 1) tlHTML += '<div class="timeline-line"></div>';
  });
  document.getElementById('s-timeline').innerHTML = tlHTML;
  document.getElementById('s-timeline-note').innerHTML = t.timelineNote;

  // Alerts
  const keyMetrics = ['WBC','Neut_abs','Neut_pct','PLT','HGB','Mono_pct','MPV','PDW','PCT'];
  const flags = keyMetrics
    .map(k => ({ key:k, val:LATEST[k], status:getStatus(k, LATEST[k]) }))
    .filter(f => f.status !== 'normal');

  let alertHTML = '';
  if (flags.length === 0) {
    alertHTML = `<div style="color:var(--normal);font-size:13px">${t.allNormal}</div>`;
  } else {
    flags.forEach(f => {
      const r = REFS[f.key];
      const color = COLORS[f.status];
      const label = currentLang === 'zh' ? r.zh : r.en;
      const badge = f.status === 'low' ? t.statusLow : t.statusHigh;
      alertHTML += `
        <div class="alert-item" style="background:${color}18;border-color:${color}44">
          <div>
            <div class="alert-name" style="color:var(--text)">${label}</div>
            <div class="alert-ref">${t.refRange}: ${r.lo}â€“${r.hi} ${r.unit}</div>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <span class="alert-value" style="color:${color}">${f.val} ${r.unit}</span>
            <span class="alert-badge" style="color:${color};border-color:${color}66;background:${color}22">${badge}</span>
          </div>
        </div>`;
    });
  }
  document.getElementById('s-alerts').innerHTML = alertHTML;

  // Key Metrics
  const keyDisplay = ['WBC','Neut_abs','PLT','HGB','Lymph_abs','Mono_pct'];
  let metricsHTML = '';
  keyDisplay.forEach(k => {
    const r = REFS[k];
    const val = LATEST[k];
    const st = getStatus(k, val);
    const color = COLORS[st];
    const label = currentLang === 'zh' ? r.zh : r.en;
    const pos = pctPos(k, val);
    const badge = st === 'normal' ? t.statusNormal : (st === 'low' ? t.statusLow : t.statusHigh);
    metricsHTML += `
      <div class="metric-card" style="border-color:${color}44">
        <div class="metric-label">${label}</div>
        <div class="metric-value" style="color:${color}">${val}</div>
        <div class="metric-unit">${r.unit}</div>
        <div class="gauge-track">
          <div class="gauge-normal-zone" style="background:${COLORS.normal}22"></div>
          <div class="gauge-dot" style="left:${pos}%;background:${color};box-shadow:0 0 6px ${color}"></div>
        </div>
        <div class="gauge-labels"><span>${r.lo}</span><span>${r.hi}</span></div>
        <div class="metric-ref">${t.refRange}: ${r.lo}â€“${r.hi}</div>
        <div style="margin-top:4px">
          <span style="font-size:10px;font-weight:700;color:${color};padding:2px 6px;background:${color}22;border:1px solid ${color}44;border-radius:4px">${badge}</span>
        </div>
      </div>`;
  });
  document.getElementById('s-metrics').innerHTML = metricsHTML;

  // Clinical Notes
  const noteColors = { low: COLORS.low, high: COLORS.high, normal: COLORS.normal, accent: COLORS.accent };
  let clinHTML = '';
  t.clinicalNotes.forEach(note => {
    const color = noteColors[note.color];
    clinHTML += `
      <div class="clinical-note" style="background:${color}15;border-left-color:${color}">
        <strong style="color:${color}">${note.title}</strong>
        ${note.body}
      </div>`;
  });
  document.getElementById('s-clinical').innerHTML = clinHTML;
}

function renderFull() {
  const t = T[currentLang];
  document.getElementById('f-title').textContent = t.fullCBCTitle;

  // Draw selector buttons
  const drawLabels_en = ["Jan 26 Â· C1 Day 7", "Feb 2 Â· C1 Day 14", "Feb 18 Â· C2 Day 7", "Feb 24 Â· C2 Day 14"];
  const drawLabels_zh = ["1æœˆ26æ—¥ Â· C1ç¬¬7å¤©", "2æœˆ2æ—¥ Â· C1ç¬¬14å¤©", "2æœˆ18æ—¥ Â· C2ç¬¬7å¤©", "2æœˆ24æ—¥ Â· C2ç¬¬14å¤©"];
  const drawLabels = currentLang === 'zh' ? drawLabels_zh : drawLabels_en;

  let selectorHTML = '';
  DATA.forEach((d, i) => {
    const isActive = i === selectedDrawIndex;
    const isLatest = i === DATA.length - 1;
    selectorHTML += `
      <button onclick="selectDraw(${i})" style="
        padding:7px 14px;border-radius:6px;border:1px solid;cursor:pointer;
        font-size:11px;font-weight:600;font-family:inherit;transition:all 0.2s;
        background:${isActive ? 'var(--accent)' : 'var(--panel)'};
        border-color:${isActive ? 'var(--accent)' : 'var(--border)'};
        color:${isActive ? '#fff' : 'var(--muted)'};
      ">${drawLabels[i]}${isLatest ? (currentLang==='zh'?' â˜…æœ€æ–°':' â˜… Latest') : ''}</button>`;
  });
  document.getElementById('f-draw-selector').innerHTML = selectorHTML;

  const ROW = DATA[selectedDrawIndex];

  const groups = [
    { title: t.groups[0], keys: ['WBC','Neut_abs','Neut_pct','Lymph_abs','Lymph_pct','Mono_abs','Mono_pct'] },
    { title: t.groups[1], keys: ['HGB','RBC','Hct','MCV','MCH','MCHC','RDW_CV','RDW_SD'] },
    { title: t.groups[2], keys: ['PLT','MPV','PDW','PCT','P_LCR'] },
    { title: t.groups[3], keys: ['Eos_pct','Eos_abs','Baso_pct','Baso_abs'] },
  ];

  let html = '';
  groups.forEach(g => {
    html += `<div class="cbc-group-title">${g.title}</div>`;
    g.keys.forEach(k => {
      const r = REFS[k];
      const val = ROW[k];
      const st = getStatus(k, val);
      const color = COLORS[st];
      const label = currentLang === 'zh' ? r.zh : r.en;
      const pos = pctPos(k, val);
      const badge = st !== 'normal' ? `<span style="font-size:10px;font-weight:700;color:${color};padding:2px 6px;background:${color}22;border:1px solid ${color}44;border-radius:4px">${st==='low'?t.statusLow:t.statusHigh}</span>` : '';

      // Mini trend sparkline: show all 4 values as small dots
      let sparkHTML = '<div style="display:flex;align-items:center;gap:3px;margin-top:4px">';
      DATA.forEach((d, di) => {
        const sv = d[k];
        const sst = getStatus(k, sv);
        const sc = COLORS[sst];
        const isSelected = di === selectedDrawIndex;
        sparkHTML += `<div title="${CHART_LABELS[di]}: ${sv}" style="
          width:${isSelected?10:7}px;height:${isSelected?10:7}px;border-radius:50%;
          background:${sc};opacity:${isSelected?1:0.45};
          border:${isSelected?'2px solid #fff':'none'};
          cursor:default;flex-shrink:0;
        "></div>`;
        if (di < DATA.length - 1) {
          sparkHTML += `<div style="width:8px;height:1px;background:var(--border);flex-shrink:0"></div>`;
        }
      });
      sparkHTML += '</div>';

      html += `
        <div class="cbc-row">
          <div class="cbc-row-name">
            ${label}
            ${sparkHTML}
          </div>
          <div class="cbc-row-val" style="color:${st!=='normal'?color:'var(--text)'}">
            ${val} <span style="font-size:10px;color:var(--muted)">${r.unit}</span>
          </div>
          <div class="cbc-row-badge">${badge}</div>
          <div class="cbc-row-gauge">
            <div class="gauge-track">
              <div class="gauge-normal-zone" style="background:${COLORS.normal}22"></div>
              <div class="gauge-dot" style="left:${pos}%;background:${color};box-shadow:0 0 5px ${color}"></div>
            </div>
            <div class="gauge-labels"><span>${r.lo}</span><span>${r.hi}</span></div>
          </div>
        </div>`;
    });
  });
  document.getElementById('f-table').innerHTML = html;
  document.getElementById('footer').textContent = t.disclaimer + ' Â· Generated ' + new Date().toLocaleDateString();
}

function selectDraw(index) {
  selectedDrawIndex = index;
  renderFull();
}

function renderCharts() {
  const t = T[currentLang];
  document.getElementById('c-note').textContent = t.chartNote;
  t.chartTitles.forEach((title, i) => {
    document.getElementById('ct-'+i).textContent = title;
  });

  const chartConfigs = [
    {
      keys: ['WBC', 'Neut_abs'],
      colors: ['#3b8aff', '#ff6b6b'],
      refLines: [
        { value: REFS.WBC.lo, color: '#3b8aff55', label: '' },
        { value: REFS.WBC.hi, color: '#3b8aff55', label: '' },
        { value: REFS.Neut_abs.lo, color: '#ff6b6b88', label: '' },
        { value: REFS.Neut_abs.hi, color: '#ff6b6b33', label: '' },
      ]
    },
    { keys: ['PLT'], colors: ['#a78bfa'], refLines: [
      { value: REFS.PLT.lo, color: '#a78bfa55' }, { value: REFS.PLT.hi, color: '#a78bfa55' }
    ]},
    { keys: ['HGB'], colors: ['#34d399'], refLines: [
      { value: REFS.HGB.lo, color: '#34d39955' }, { value: REFS.HGB.hi, color: '#34d39955' }
    ]},
    { keys: ['Lymph_pct','Mono_pct'], colors: ['#3b8aff','#ffaa00'], refLines: [
      { value: REFS.Lymph_pct.lo, color: '#3b8aff44' }, { value: REFS.Lymph_pct.hi, color: '#3b8aff44' },
      { value: REFS.Mono_pct.hi, color: '#ffaa0088' },
    ]},
    { keys: ['MCV'], colors: ['#60a5fa'], refLines: [
      { value: REFS.MCV.lo, color: '#60a5fa55' }, { value: REFS.MCV.hi, color: '#60a5fa55' }
    ]},
  ];

  chartConfigs.forEach((cfg, i) => {
    const canvasId = 'chart-' + i;
    if (charts[canvasId]) { charts[canvasId].destroy(); }
    const ctx = document.getElementById(canvasId).getContext('2d');

    const datasets = cfg.keys.map((k, ki) => ({
      label: t.chartLabels[k] || k,
      data: DATA.map(d => d[k]),
      borderColor: cfg.colors[ki],
      backgroundColor: cfg.colors[ki] + '22',
      borderWidth: 2.5,
      pointRadius: 5,
      pointBackgroundColor: cfg.colors[ki],
      pointBorderColor: '#0f1623',
      pointBorderWidth: 2,
      tension: 0.3,
      fill: false,
    }));

    // Add reference line datasets
    cfg.refLines.forEach(rl => {
      datasets.push({
        label: '',
        data: DATA.map(() => rl.value),
        borderColor: rl.color,
        borderWidth: 1,
        borderDash: [5, 5],
        pointRadius: 0,
        fill: false,
        tension: 0,
      });
    });

    charts[canvasId] = new Chart(ctx, {
      type: 'line',
      data: { labels: CHART_LABELS, datasets },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: cfg.keys.length > 1,
            labels: { color: '#7a90a8', font: { size: 11 }, filter: item => item.text !== '' }
          },
          tooltip: {
            backgroundColor: '#161f30',
            borderColor: '#1e2d45',
            borderWidth: 1,
            titleColor: '#3b8aff',
            bodyColor: '#e2eaf5',
            titleFont: { size: 12 },
            bodyFont: { size: 12 },
            callbacks: {
              title: (items) => {
                const idx = items[0].dataIndex;
                return currentLang === 'zh' ? DATA[idx].cycleZH : DATA[idx].fullDate;
              }
            },
            filter: item => item.dataset.label !== ''
          }
        },
        scales: {
          x: {
            ticks: { color: '#7a90a8', font: { size: 10 } },
            grid: { color: '#1a2640' }
          },
          y: {
            ticks: { color: '#7a90a8', font: { size: 10 } },
            grid: { color: '#1a2640' }
          }
        }
      }
    });
  });
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderAll();
</script>
</body>
</html>
